<style>
  * {
    background-color: #352e2e;
    font-family: monospace;
    color: rgb(60, 255, 1);
    padding: 0px;
  }

  button,
  datalist {
    background-color: rgb(85, 85, 85);
  }

  input[type="text"] {
    color: rgb(179, 255, 179);
    background-color: rgb(102, 86, 86);
    border: 1px solid;
    border-color: #696 #363 #363 #696;
  }

  [type="checkbox"] {
    vertical-align: middle;
  }

  #serialResults {
    font-family: monospace;
    white-space: pre;
    height: calc(100% - 120px);
    width: calc(100% - 20px);
    border-style: solid;
    overflow: scroll;
    background-color: rgb(88, 92, 92);
    padding: 10px;
    margin: 0px;
  }
</style>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Fastest Serial terminal in your browser for Chrome.</title>
<meta
  name="Description"
  content="Set your baud speed and hit connect.
 A serial terminal that runs with out any plugins in chrome."
/>

<button onclick="connectSerial()">Connect</button>
<button onclick="serialResultsDiv.innerHTML = '';">Clear</button>
<div id="serialResults"></div>
<script>
  var port,
    textEncoder,
    writableStreamClosed,
    writer,
    historyIndex = -1;
  const lineHistory = [];
  const serialResultsDiv = document.getElementById("serialResults");
  async function connectSerial() {
    try {
      // Prompt user to select any serial port.
      port = await navigator.serial.requestPort();
      await port.open({ baudRate: 9600 });
      textEncoder = new TextEncoderStream();
      writableStreamClosed = textEncoder.readable.pipeTo(port.writable);
      writer = textEncoder.writable.getWriter();
      await listenToPort();
    } catch (e) {
      alert("Serial Connection Failed" + e);
    }
  }

  async function listenToPort() {
    const textDecoder = new TextDecoderStream();
    const readableStreamClosed = port.readable.pipeTo(textDecoder.writable);
    const reader = textDecoder.readable.getReader();

    // Listen to data coming from the serial device.
    while (true) {
      const { value, done } = await reader.read();
      if (done) {
        // Allow the serial port to be closed later.
        console.log("[readLoop] DONE", done);
        reader.releaseLock();
        break;
      }
      // value is a string.
      appendToTerminal(value);
    }
  }

  async function appendToTerminal(newStuff) {
    serialResultsDiv.innerHTML += newStuff;
    if (serialResultsDiv.innerHTML.length > 3000)
      serialResultsDiv.innerHTML = serialResultsDiv.innerHTML.slice(
        serialResultsDiv.innerHTML.length - 3000
      );

    //scroll down to bottom of div
    serialResultsDiv.scrollTop = serialResultsDiv.scrollHeight;
  }
</script>
